---
title: BLEでアプリケーションパラメータ設定
date: 2022-02-07
tags: ["RaspberryPi", "python", "ESP32", "BLE"]
excerpt: ESP32 BLEを使用してアプリケーションパラメータの設定を変更する処理の雛形
---
# 概要

アプリケーションを作成したとき、マシン名のように端末毎に変更を変更したり、
サーバ名のように設置条件によって変更したいパラメータってありますよね。  
いつもは起動時に設定モードに入ったり、動作中に簡易シェルを動かしてコンソール(UART)から設定していましたが、  
実装面積などの関係でUARTが接続できなかったりした場合、それ以外の方法としてBLEで設定する方法を考えました。  
(ESP32の場合、Flash書き換えでUART使うので繋がない訳にはいかないのですが...)  

[ESP32でBLEのデモを動かす]({{ site.baseurl }}/2022/01/19/ESP32_BLE_1.html){:target="_blank"} 
[ESP32でBLEのデモを動かす 補足]({{ site.baseurl }}/2022/01/21/ESP32_BLE_2.html){:target="_blank"} 
を参考にカスタムプロファイルでアプリケーションパラメータをread/writeできるようにしてみました。  


# プログラムソース
使用したESP32側のソースは<https://github.com/ippei8jp/BLE_PARAM_CONFIG>{:target="_blank"}  
にあるのでcloneしてください。  

このプログラムではアプリケーションはWi-Fiに接続するだけの処理です。  
うまくパラメータが設定できて、nvsに保存しておけば、2回目以降はBLEによる設定なしにWi-Fiに接続することができます。  
接続できれば、外部マシンからpingを打って応答があることが確認できます。  


# 使い方
<https://github.com/ippei8jp/BLE_PARAM_CONFIG>{:target="_blank"} のREADME.mdを参照してください。  

>[!NOTE]
> パラメータの設定はRaspberryPiのpythonから行っていますが、その気になればAndroidのBLE接続確認ツールなどからでも設定できます。  

>[!NOTE]
> 設定パラメータにループインターバルがありますが、プログラム中では参照していません。  
> 数値を設定する例として入れてあります。  


# 解説
は、、、、、面倒なのでソース読んでちょ。(^^ゞ   


# 応用
設定したいパラメータが増えてたら、Characteristicを増やしていけばいくらでも対応できるハズ...



