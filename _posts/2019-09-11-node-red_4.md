---
title: Node-REDのHowTo(その4)
date: 2019-09-11
tags: ["Ubuntu","RaspberryPi","Node.js","Node-RED"]
excerpt: Node-REDのメモ Dashboard編
layout: default
---

Node-REDでDashboardでUIを作成するときの設定手順のメモ。  
鶏頭で忘れっぽいのでメモ。  

# Dashboardをインストールする

- ブラウザでNode-REDに接続した状態で、右上の3本線メニュー(≡) から「パレットの管理」をクリック
- 画面上部の「ノードを追加」をクリック
- ノードを検索の部分に「node-red-dashboard」と入力
- 下に検索結果が出るので。「node-red-dashboard」の「ノードを追加」をクリック
- 何やらダイアログが出るので、「追加」をクリック
- 完了したら「閉じる」をクリック。

# Dashboard のUIを作成する(ボタン)

- パレット(左側のペイン)の「dashboard」の下の「button」 をフローにドラッグ&ドロップ
- ドロップした「button」をダブルクリック → 編集メニューが表示される
    - 「Group」 で「新規に ui_group を追加...」を選択してその右の編集ボタンをクリック
        - 「名前」は適当に設定
        - 「タブ」 で「新規に ui_tab を追加...」を選択してその右の編集ボタンをクリック
            - 適当に値を設定する
            - 右上の「追加」をクリック
        - または、既存のタブを選択
        - 右上の「追加」をクリック
    - または、既存のグループを選択
    - 「Group」 に 今設定したグループとタブが選択されていることを確認
    - 「Size」 で表示サイズを選択。後でレイアウト見ながら変更した方がやりやすいと思う
    - 「label」 でUI画面での表示名を設定
    - 「Icon」「Tooltip」「Colour」「Background」はオプションなので空欄のままで可
    - 「Payload」 に クリックされたときに送信するデータを設定
    - 「Topic」は必要なら設定。空欄のままでも可。
    - 必要なら「名前」を設定
        - 省略すると「Label」に設定した値が表示される
    - 右上の「完了」をクリック

- 次段以降のノードを追加
- デプロイする

# ブラウザでDashboardのUIに接続する

- ブラウザで、http://対象IPアドレス:1880/ui に接続
    - Dashboardが表示されるハズ
        - 複数のタブがある場合、左上の3本線メニュー(≡)から切り替えられる
    - ボタンをクリックしたらフローが動作する。

# Dashboard のUIを作成する(スライダ)

- パレットの「dashboard」の下の「slider」 をフローにドラッグ&ドロップ
- ドロップした「slider」をダブルクリック → 編集メニューが表示される
    - 「Group」 で「新規に ui_group を追加...」を選択してその右の編集ボタンをクリック
        - 設定方法は上記参照
    - または、既存のグループを選択
    - 「Group」 に 今設定したグループとタブが選択されていることを確認
    - 「Size」 で表示サイズを選択。後でレイアウト見ながら変更した方がやりやすいと思う
    - 「label」 でUI画面での表示名を設定
    - 「Tooltip」はオプションなので空欄のままで可
    - 「Range」に値の最小値、最大値、刻みを設定
    - 「Output」を設定
        - 「continuously while sliding」：操作中、一定時間ごとにメッセージを出力
        - 「only on release」：スライダを離したとき(値を確定したとき)にメッセージを出力
    - 「Topic」は必要なら設定。空欄のままでも可。
    - 必要なら「名前」を設定
        - 省略すると「Label」に設定した値が表示される
    - 右上の「完了」をクリック

- 次段以降のノードを追加
- デプロイする


# Dashboardでゲージグラフを表示する

- パレットの「dashboard」の下の「guage」 をフローにドラッグ&ドロップ
- ドロップした「guage」をダブルクリック → 編集メニューが表示される
    - 「Group」 で「新規に ui_group を追加...」を選択してその右の編集ボタンをクリック
        - 設定方法は上記参照
    - または、既存のグループを選択
    - 「Group」 に 今設定したグループとタブが選択されていることを確認
    - 「Size」 で表示サイズを選択。後でレイアウト見ながら変更した方がやりやすいと思う
    - 「Type」 でグラフの種類を選ぶ。お好みで
    - 「label」 でUI画面での表示名を設定
    - 「Value format」 でグラフに表示する値を指定する。
        - デフォルトの``{% raw %}{{value}}{% endraw %}``では受信したデータのpayload(``msg.payload`` )が使用される
        - payloadがobjectの場合、``{% raw %}{{msg.payload.XXX}}{% endraw %}``のように指定すると特定の変数が表示できる
        - このとき、``{% raw %}{{{% endraw %}`` と ``{% raw %}}}{% endraw %}`` は波括弧を2つ重ねたもの。波括弧1つだと正常に処理されないので、注意 
        - 表示する数値の有効桁数を設定したい場合は以下のようにフィルタを設定
            - 小数点以下1桁まで表示：``{% raw %}{{value | number:1 }}{% endraw %}``
            - 整数部のみ表示：       ``{% raw %}{{value | number:0 }}{% endraw %}``
            - 10の位へ丸める：       ``{% raw %}{{value | number:-1 }}{% endraw %}``
        - 単位を表示するなど、決まった文字列を追加したい場合は「``{% raw %}{{・・・}}℃{% endraw %}``」のように波括弧の外側に追加
    - 「units」 で単位を設定する。温度なら「℃」など。これは数値表示には表示されず、グラフ内部の単位情報として表示される
    - 「Range」 でグラフの値の範囲を指定する。「-20」～「40」など。
        - 入力値が範囲外になった場合はグラフが上下限に張り付くだけで、エラーなどにはならない。また値そのものは数値表示される  
    - 「Colour gradient」 でグラフの色を指定する。3つの色は下で設定するSectors の範囲に対応する
    - 「Sectors」 で 上で指定した色を表示する範囲を設定する
        - これはオプションなので設定しなくても良い。指定しなかった場合は上の「Range」で指定した値の範囲を3等分して使用される
    - 必要なら「Name」を設定
        - 省略すると「Label」に設定した値が表示される
    - 右上の「完了」をクリック
- 表示する値を作成するノードを接続する
- デプロイする

>[!NOTE]
> Value formatのフィルタの詳細は<https://scotch.io/tutorials/all-about-the-built-in-angularjs-filters>を見ろと書かれていましたが、残念ながら私にはよく分かりませんでした...  

# Dashboardでテキストを表示する

- パレットの「dashboard」の下の「text」 をフローにドラッグ&ドロップ
- ドロップした「text」をダブルクリック → 編集メニューが表示される
    - 「Group」 で「新規に ui_group を追加...」を選択してその右の編集ボタンをクリック
        - 設定方法は上記参照
    - または、既存のグループを選択
    - 「Group」 に 今設定したグループとタブが選択されていることを確認
    - 「Size」 で表示サイズを選択。後でレイアウト見ながら変更した方がやりやすいと思う
    - 「Type」 でグラフの種類を選ぶ。お好みで
    - 「label」 でUI画面での表示名を設定
    - 「Value format」 でグラフに表示する値を指定する。
        - 上記参照
    - 「Layout」でレイアウトを選択。お好みで
    - 必要なら「Name」を設定
        - 省略すると「Label」に設定した値が表示される
    - 右上の「完了」をクリック
- 表示する値を作成するノードを接続する
- デプロイする

### フローの例

``` 
{% raw %}
[
    {
        "id": "a226513f.c36b1",
        "type": "tab",
        "label": "Dashboard_1",
        "disabled": false,
        "info": ""
    },
    {
        "id": "160486fa.dc7159",
        "type": "ui_button",
        "z": "a226513f.c36b1",
        "name": "",
        "group": "1127e563.00001b",
        "order": 1,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "ON",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "ON",
        "payloadType": "str",
        "topic": "",
        "x": 130,
        "y": 100,
        "wires": [
            [
                "e89b8821.ec65e8",
                "84bd2adf.3b5df8"
            ]
        ]
    },
    {
        "id": "e89b8821.ec65e8",
        "type": "debug",
        "z": "a226513f.c36b1",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 580,
        "y": 100,
        "wires": []
    },
    {
        "id": "d4346336.cf1228",
        "type": "ui_button",
        "z": "a226513f.c36b1",
        "name": "",
        "group": "1127e563.00001b",
        "order": 2,
        "width": 2,
        "height": 1,
        "passthru": false,
        "label": "OFF",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "OFF",
        "payloadType": "str",
        "topic": "",
        "x": 130,
        "y": 160,
        "wires": [
            [
                "e89b8821.ec65e8",
                "84bd2adf.3b5df8"
            ]
        ]
    },
    {
        "id": "e403fdac.aa3748",
        "type": "ui_slider",
        "z": "a226513f.c36b1",
        "name": "",
        "label": "温度",
        "tooltip": "",
        "group": "1127e563.00001b",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "all",
        "topic": "",
        "min": "-30",
        "max": "50",
        "step": 1,
        "x": 140,
        "y": 240,
        "wires": [
            [
                "e89b8821.ec65e8",
                "78c10ecb.1eb67"
            ]
        ]
    },
    {
        "id": "78c10ecb.1eb67",
        "type": "ui_gauge",
        "z": "a226513f.c36b1",
        "name": "",
        "group": "1127e563.00001b",
        "order": 6,
        "width": 4,
        "height": 4,
        "gtype": "gage",
        "title": "温度",
        "label": "℃",
        "format": "{{value}}℃",
        "min": "-20",
        "max": "40",
        "colors": [
            "#0000ff",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "0",
        "seg2": "30",
        "x": 570,
        "y": 240,
        "wires": []
    },
    {
        "id": "84bd2adf.3b5df8",
        "type": "ui_text",
        "z": "a226513f.c36b1",
        "group": "1127e563.00001b",
        "order": 3,
        "width": 2,
        "height": 1,
        "name": "",
        "label": "SW",
        "format": "{{value}}",
        "layout": "row-spread",
        "x": 560,
        "y": 180,
        "wires": []
    },
    {
        "id": "1127e563.00001b",
        "type": "ui_group",
        "z": "",
        "name": "グループ1",
        "tab": "6547952b.517b34",
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "6547952b.517b34",
        "type": "ui_tab",
        "z": "",
        "name": "タブ1",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    }
]
{% endraw %} 
```

# Dashboard のレイアウトを修正する

ボタンのサイズを小さくしたり、複数のボタンを横に並べたい場合はレイアウトの修正を行う。  

- サイドバー(右側のペイン)の「dashboard」ボタン(グラフのアイコン)をクリック
- 配置タブをクリック
- タブの部分(「ホーム」など)をマウスでポイントし、「レイアウト」をクリック
    - 表示領域の幅を変更するには、右上の「幅」の設定値を変更する。(単位はグリッド数)
    - 各要素をドラッグすると、表示位置を入れ替えられる。
    - 各要素のサイズを変更するには、
        - 右上の鍵アイコンをクリックして閉じた状態にする(鍵が開いた状態では表示領域幅に一致するように自動変更される)
        - 右下に矢印アイコンが表示されるので、これをつまんでサイズを変更
    - 各要素を横並びにしたい場合は、各要素をドラッグして移動する(表示幅に収まらない場合は移動できない)
    - 各要素のサイズ/位置はグリッド単位でのみ可能
    - 右上の完了をクリック
ｰ デプロイする

